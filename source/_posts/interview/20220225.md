---
title: 连等赋值问题
date: 2022-02-25 16:20:41
tags: javascript
categories: Interview
---

坐着突然看到一个题，想了一下答错了，看了题解之后还是不太理解，终于在一个大佬的白话中get到卡住的点！

解答地址：https://www.cnblogs.com/fansama/p/6648956.html

### 1.赋值表达式的概念：

计算一般的赋值表达式` A = B`按如下步骤：

1. 计算表达式A，得到一个引用`refA`；
2. 计算表达式B，得到一个值`valueB`；
3. 将`valueB`赋给`refA`指向的名称绑定；
4. 返回`valueB`。‘

### 连等的核心思想：

连等是先确定**所有**变量的指针，再让指针指向那个赋值

### 对于题1:

```js
1 var a = b =10;
2      (function(){
3          var a = b = 20;
4       })();
5 console.log(a);
6 console.log(b);
//问：输出的 a = ?    b = ?
//10 20
```

- 首先第一行的 var a = b = 10; 就是用了连等操作符，连等操作符是**从右向左的** 所以类似于b = 10; a = b;或者是 a = (b = 10);
  - 此时，变量**a**是用**var**进行声明并赋值的所以是**局部变量**，
  - 但是b是未声明而直接进行赋值的所以是**全局变量**。
- 第二行开始使用匿名函数实现模仿块级作用于（私有作用域）:**<u>在里面声明的变量会在函数结束后被销毁除非被外部所使用</u>**
- 第三行，先使用外部局部变量b，b =20; 然后又**<u>重新声明了一个变量a</u>**
  - 此时内部的局部新生成的a为20
- 第四行声明定义一个匿名函数后随即执行，**<u>私有作用域中创建的变量a在结束后随即被销毁</u>**.所以最后改变的只有外部的变量b的值.
  - 此时b=20 ,a还是为之前外部的10

### 对于题2:

```js
1 var a = {n: 1};
2 var b = a;
3 a.x = a = {n: 2};
4 alert(a.x); // --> 
5 alert(b.x); // --> 
```

- 第三行声明变量b，并且把a的对象引用赋值给b。

  - 此时，变量b和a指向的是同一个对象，即他们现在共享。
  - a:{n:2},b:{n:2}

- 第四行:------------连等是先确定**所有**变量的指针，再让指针指向那个赋值

  - 找到 a 和 a.x 的指针。如果已有指针，那么不改变它。如果没有指针，即那个变量还没被申明，那么就创建它，指向 null。
    - 此时，a 是有指针的，指向 `{n:1}`；
    - a.x 是没有指针的，所以创建它，指向 null。
  - **`.`运算优先于`=`赋值运算**，因此此处赋值可理解为
    1. 声明a对象中的x属性，用于赋值，此时b指向a，同时拥有未赋值的x属性
    2. 对a对象赋值，此时变量名a改变指向到对象{n:2}
    3. 对步骤1中x属性，也即a原指向对象的x属性，也即b指向对象的x属性赋值

- 上图更明确：

  ![连等赋值](https://raw.githubusercontent.com/jannicaTan/image_picX/master/Interview/连等赋值.webp)
