---
title: 浏览器输入URL过程详解
date: 2022-03-27 22:47:12
tags: 计算机网络
categories: Interview
---

- 重要！当你在浏览器中输入 [Coogle.com](http://Coogle.com) 井且按下回车之后发生了什么？

  这篇写的太详细了！https://juejin.cn/post/6844904021308735502#heading-46

  - 网络方面

    - 总结过程![img](https://api2.mubu.com/v3/document_image/84e65d37-2dbd-41bc-b0b4-04588954c430-17016005.jpg)

    - \1. 构建请求：
      浏览器会构建请求行:

    - \2. 查找强缓存：浏览器缓存在加载页面中的应用
      先检查强缓存，如果命中直接使用，否则进入下一步。

    - \3. DNS解析域名

      - 由于我们输入的是域名，而数据包是通过IP地址传给对方的。因此我们需要得到域名对应的IP地址。这个过程需要依赖一个服务系统，这个系统将域名和 IP 一一映射，我们将这个系统就叫做DNS（域名系统）。得到具体 IP 的过程就是DNS解析。

      - 注意：浏览器提供了DNS数据缓存功能。即如果一个域名已经解析过，那会把解析的结果缓存下来，下次处理直接走缓存，不需要经过 DNS解析。如果不指定端口的话，默认采用对应的 IP 的 80 端口。

    - \4. 建立 TCP 连接

      - 注意：Chrome 在同一个域名下要求同时最多只能有 6 个 TCP 连接，超过 6 个的话剩下的请求就得等待。

      - 建立 TCP连接经历了下面三个阶段:

        - 通过TCP三次握手(即总共发送3个数据包确认已经建立连接)建立客户端和服务器之间的连接。

        - 进行数据传输。这里有一个重要的机制，就是接收方接收到数据包后必须要向发送方确认, 如果发送方没有接到这个确认的消息，就判定为数据包丢失，并重新发送该数据包。
          - 优化策略：拆包——就是把大的数据包拆成一个个小包，依次传输到接收方，接收方按照这个小包的顺序把它们组装成完整数据包。

        - 断开连接的阶段。数据传输完成，现在要断开连接了，通过TCP四次挥手来断开连接。

    - 5.发送 HTTP 请求
      TCP连接建立完毕，浏览器可以和服务器开始通信，即开始发送 HTTP 请求。

    - 6.网络响应
      HTTP 请求到达服务器，服务器进行对应的处理。最后要把数据传给浏览器，也就是返回网络响应。
      ​

    - 7.响应完成，判断Connection字段是否建立持久连接
      - 如果请求头或响应头中包含Connection: Keep-Alive，表示建立了持久连接，这样TCP连接会一直保持，之后请求统一站点的资源会复用这个连接。否则断开TCP连接, 请求-响应流程结束。

  - 解析算法篇

    浏览器解析html代码，并请求html代码中的资源（如js、css、图片等）（先得到html代码，才能去找这些资源）

    - 生成布局树(Layout Tree)

    - 样式计算【解析CSS文件（将其转化为一个结构化的对象，即styleSheets）构建渲染树】

    - 构建 DOM树

  - 渲染过程

    - 建立图层树(Layer Tree)

    - 生成绘制列表
      渲染引擎会将图层的绘制拆分成一个个绘制指令，比如先画背景、再描绘边框......然后将这些指令按顺序组合成一个待绘制列表

    - 生成图块并栅格化

    - 显示器显示内容
